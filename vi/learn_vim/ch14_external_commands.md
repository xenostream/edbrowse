# Ch14. External Commands
유닉스 시스템 내부에는 한 가지 일을 (그리고 그것을 잘) 수행하는 작고 초특화된 명령어들이 많이 있습니다. 이런 명령어들을 연결해서 복잡한 문제를 해결할 수 있습니다. Vim 내부에서 이런 명령어들을 사용할 수 있다면 얼마나 좋을까요?

물론 가능합니다. 이 장은 Vim을 확장해서 외부 명령어와 원활하게 연동하는 방법을 배웁니다.


## The Bang Command
Vim에는 세 가지 기능을 수행하는 뱅(`!`) 명령어가 있습니다:

1. 외부 명령어의 STDOUT을 현재 버퍼로 읽습니다.
2. 버퍼의 내용을 외부 명령어의 STDIN으로 출력합니다.
3. Vim 내부에서 외부 명령어를 실행합니다.

각 기능을 살펴보겠습니다.


## Reading the STDOUT of a Command Into Vim
외부 명령의 STDOUT을 현재 버퍼로 읽는 구문은 다음과 같습니다:

```
:r !cmd
```

`:r` 은 Vim의 읽기 명령입니다. `!` 없이 사용하면 파일 내용을 가져올 수 있습니다. 현재 디렉토리에 `file1.txt` 파일이 있고 다음을 실행하면:

```
:r file1.txt
```

Vim은 `file1.txt`의 내용을 현재 버퍼에 넣습니다.

`:r` 명령 뒤에 `!` 와 외부 명령을 실행하면 해당 명령의 출력이 현재 버퍼에 삽입됩니다. `ls` 명령의 결과를 얻으려면 다음을 실행합니다:

```
:r !ls
```

다음과 같은 결과가 반환됩니다:

```
file1.txt
file2.txt
file3.txt
```

`curl` 명령어의 데이터를 읽을 수도 있습니다:

```
:r !curl -s 'https://jsonplaceholder.typicode.com/todos/1'
```

`r` 명령어는 주소도 받아들입니다:

```
:10r !cat file1.txt
```

이제 `cat file1.txt` 실행의 STDOUT이 10번째 줄 뒤에 삽입됩니다.


## Writing the Buffer Content Into an External Command
`:w` 명령어는 파일을 저장하는 것 외에도 현재 버퍼의 텍스트를 외부 명령어의 STDIN으로 전달하는 데 사용할 수 있습니다. 구문은 다음과 같습니다:

```
:w !cmd
```

다음과 같은 표현이 있다면:

```
console.log(“Hello Vim”);
console.log(“Vim is awesome”);
```

컴퓨터에 [node](https://nodejs.org/en/) 가 설치되어 있는지 확인한 후 다음을 실행합니다:

```
:w !node
```

Vim은 `node` 를 사용해서 JavaScript 표현식을 실행해서 “Hello Vim” 과 “Vim is awesome” 을 출력합니다.

`:w` 명령을 사용할 때, Vim은 현재 버퍼의 모든 텍스트를 사용합니다. 이는 글로벌 명령어와 유사합니다. (대부분의 명령줄 명령어는 범위를 지정하지 않으면 현재 줄에 명령을 실행합니다.) `:w`에 특정 주소를 전달하면:

```
:2w !node
```

Vim은 두 번째 줄부터 시작하는 텍스트만 `node` 인터프리터에 전달합니다.

`:w !node` 와 `:w! node` 사이에는 미묘하지만 중요한 차이가 있습니다. `:w !node` 는 현재 버퍼의 텍스트를 외부 명령어 `node` 에 “쓰기” 합니다. 반면 `:w! node` 는 파일을 강제 저장하며 파일 이름을 “node” 로 지정합니다.


## Executing an External Command
Vim 내부에서 외부 명령을 실행하려면 뱅(bang) 명령을 사용합니다. 구문은 다음과 같습니다:

```
:!cmd
```

현재 디렉토리의 내용을 긴 형식으로 보려면 다음을 실행합니다:

```
:!ls -ls
```

PID 3456으로 실행 중인 프로세스를 종료하려면 다음을 실행합니다:

```
:!kill -9 3456
```

Vim을 벗어나지 않고도 모든 외부 명령어를 실행할 수 있으므로 작업에 집중할 수 있습니다.


## Filtering Texts
`!` 에 범위를 지정하면 텍스트 필터링에 사용할 수 있습니다. 다음과 같은 텍스트를 가정합니다:

```
hello vim
hello vim
```

`tr` 명령어를 사용해서 현재 줄을 대문자로 변환해 보겠습니다. 다음을 실행합니다:

```
:.!tr ‘[:lower:]’ '[:upper:]'
```

실행 결과:

```
HELLO VIM
hello vim
```

세부 설명:

- `.!` 는 현재 줄에 필터 명령어를 실행합니다.
- `tr ‘[:lower:]’ '[:upper:]'` 는 `tr` 명령어를 호출해서 모든 소문자를 대문자로 바꿉니다.

필터로 외부 명령을 실행하려면 범위를 반드시 지정해야 합니다. 위 명령을 `.` 없이 실행하면(`:!tr ‘[:lower:]’ '[:upper:]'`), 오류가 발생합니다.

`awk` 명령으로 두 줄 모두에서 두 번째 열을 제거한다고 가정해 보겠습니다:

```
:%!awk "{print $1}"
```

실행 결과:

```
hello
hello
```

세부 설명:

- `:%!` 는 모든 줄(`%`)에 필터 명령어를 실행합니다.
- `awk “{print $1}”` 는 일치하는 행의 첫 번째 열만 출력합니다.

터미널처럼 체인 연산자(`|`)로 여러 명령어를 연결할 수 있습니다. 예를 들어, 다음과 같은 맛있는 아침 식사 항목이 담긴 파일을 가정합니다:

```
name price
chocolate pancake 10
buttermilk pancake 9
blueberry pancake 12
```

가격 기준으로 정렬하고 균일한 간격으로 배열된 메뉴만 표시하려면 다음을 실행합니다:

```
:%!awk 'NR > 1' | sort -nk 3 | column -t
```

실행 결과:

```
buttermilk pancake 9
chocolate pancake 10
blueberry pancake 12
```

세부 설명:

- `:%!` 는 모든 줄(`%`)에 필터를 적용합니다.
- `awk ‘NR > 1’` 은 두 번째 행부터의 텍스트만 표시합니다.
- `|` 다음 명령어를 연결합니다.
- `sort -nk 3` 열 3의 값(`k 3`)을 기준으로 숫자 순서(`n`)로 정렬합니다.
- `column -t` 텍스트를 균일한 간격으로 정렬합니다.


## Normal Mode Command
Vim은 일반 모드에서 필터 연산자(`!`)를 제공합니다. 다음과 같은 인사말이 있을 때:

```
hello vim
hola vim
bonjour vim
salve vim
```

현재 줄과 그 아래 줄을 대문자로 바꾸려면 다음을 실행합니다:

```
!jtr ‘[a-z]’ '[A-Z]'
```

세부 설명:

- `!j` 는 현재 줄과 그 아래 줄을 대상으로 하는 일반 명령 필터 연산자(`!`)를 실행합니다. 일반 모드 연산자이므로 `동사 + 명사` 문법 규칙이 적용됨을 기억합니다. `!` 는 동사이고 `j` 는 명사입니다.
- `tr ‘[a-z]’ '[A-Z]'` 는 소문자를 대문자로 바꿉니다.

필터 일반 명령어는 최소 한 줄 이상의 이동/텍스트 객체만 작동합니다. `!iwtr ‘[a-z]’ '[A-Z]'` (내부 단어에 `tr` 적용)를 실행하면, 커서가 위치한 단어가 아닌 전체 줄에 `tr` 명령어가 적용됨을 확인할 수 있습니다.


## Learn External Commands the Smart Way
Vim은 IDE가 아닙니다. 설계상 고도로 확장 가능한 경량 모달 편집기입니다. 이런 확장성 덕분에 시스템 내의 모든 외부 명령에 쉽게 접근할 수 있습니다. 이런 외부 명령을 활용하면 Vim은 IDE에 한 걸음 더 가까워집니다. 누군가는 유닉스 시스템이 최초의 IDE라고 말하기도 했습니다.

뱅(`!`) 명령어의 유용성은 여러분이 알고 있는 외부 명령어의 수에 비례합니다. 외부 명령어 지식이 부족해도 걱정하지 마시기 바랍니다. 저 역시 배울 것이 많습니다. 이를 지속적인 학습 동기로 삼으시기 바랍니다. 텍스트를 수정할 때마다 문제를 해결할 수 있는 외부 명령어가 있는지 찾아봅니다. 모든 것을 완벽히 숙달하려고 애쓰지 말고, 현재 작업을 완료하는 데 필요한 것만 배우면 됩니다.


## Link
- Prev [Ch13. the Global Command](./ch13_the_global_command.md)
- Next [Ch15. Command-line Mode](./ch15_command-line_mode.md)
