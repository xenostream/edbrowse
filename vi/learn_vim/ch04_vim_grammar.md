# Ch04. Vim Grammar
Vim 명령어의 복잡함에 쉽게 위축될 수 있습니다. Vim 사용자가 `gUfV` 나 `1GdG` 명령을 입력하는 모습을 보면, 이 명령어들이 무엇을 하는지 즉시 알지 못할 수도 있습니다. 이 장은 Vim 명령어의 일반적인 구조를 간단한 문법 규칙으로 분해해서 설명하겠습니다.

이 장은 전체 가이드 중에서 가장 중요한 장입니다. 기본 문법 구조를 이해하면 Vim과 “대화” 할 수 있게 됩니다. 참고로, 이 장에서 **Vim 언어** 라고 표현할 때 Vimscript 언어(Vim의 내장 프로그래밍 언어, 후반 장에서 배우게 될 것입니다)를 말하는 것이 아닙니다.


## How to Learn a Language
저는 영어 원어민이 아닙니다. 13살 때 미국으로 이주하면서 영어를 배웠습니다. 새로운 언어로 말하기 위해 필요한 세 가지가 있습니다:

1. 문법 규칙을 익힙니다.
2. 어휘력을 늘립니다.
3. 연습, 연습, 또 연습합니다.

마찬가지로 Vim 언어를 말하려면 문법 규칙을 익히고, 어휘력을 늘리며, 명령어를 생각 없이 실행할 수 있을 때까지 연습해야 합니다.


## Grammar Rule

Vim 언어에는 단 하나의 문법 규칙만 존재합니다:

```
verb + noun
```

이게 전부입니다!

이는 다음과 같은 영어 구문을 말하는 것과 같습니다:

- “Eat (동사) a donut (명사)”
- “Kick (동사) a ball (명사)”
- “Learn (동사) the Vim editor (명사)”

이제 기본적인 Vim 동사와 명사로 어휘를 쌓아야 합니다.


## Nouns (Motions)
명사는 Vim의 이동 명령어입니다. 이동 명령어는 Vim 내에서 이동하는 데 사용됩니다. 아래는 Vim 이동 명령어의 일부 목록입니다:

```
h    왼쪽
j    아래
k    위
l    오른쪽
w    다음 단어의 시작 부분으로 이동
}    다음 단락으로 이동
$    줄 끝으로 이동
```

다음 장에서 동작(명사)에 대해 자세히 배우게 될테니, 일부 동작을 이해하지 못하더라도 너무 걱정하지 마시기 바랍니다.


## Verbs (Operators)
`:h operator` 에 따르면, Vim에는 16개의 연산자가 있습니다. 하지만, 제 경험상 다음  3가지 연산자만 익혀도 편집 작업의 80%를 해결할 수 있습니다:

```
y    텍스트 복사
d    텍스트 삭제 후 레지스터에 저장
c    텍스트 삭제 후 레지스터에 저장하고 삽입 모드 시작
```

참고로, 텍스트를 삭제한 후에는 `p` (커서 뒤에 붙여넣기) 또는 `P` (커서 앞에 붙여넣기)로 붙여넣을 수 있습니다.


## Verb and Noun
기본 명사와 동사를 익혔으니, 이제 문법 규칙인 "동사 + 명사" 를 적용해 보겠습니다! 다음과 같은 표현이 있다고 가정합니다:

```javascript
const learn = "vim";
```

- 현재 위치부터 줄 끝까지 모두 삭제하려면: `y$`
- 현재 위치부터 다음 단어 시작 부분까지 삭제하려면: `dw`
- 현재 위치부터 현재 단락 끝까지 변경하려면, 예를 들어 `c}`

이동 명령은 숫자 인수도 받습니다. (다음 장에서 설명하겠습니다.) 3줄 위로 이동하려면 `k` 를 세 번 누르는 대신 `3k` 를 입력합니다. 숫자 입력은 Vim 문법 규칙을 따릅니다.

- 왼쪽 두 글자 복사: `y2h`
- 다음 두 단어 삭제: `d2w`
- 다음 두 줄 변경: `c2j`

지금은 간단한 명령조차 실행하려면 오랫동안 고민할 수도 있습니다. 당신 혼자만 그런 게 아닙니다. 저도 처음 시작할 때 비슷한 어려움을 겪었지만 시간이 지나면서 속도가 빨라졌습니다. 여러분도 마찬가지입니다. 반복, 반복, 또 반복이 답입니다.

참고로, 줄 단위 작업(전체 줄에 영향을 미치는 작업)은 텍스트 편집에서 흔히 사용되는 작업입니다. 일반적으로 연산자 명령을 두 번 입력하면 Vim은 해당 동작에 줄 단위 작업을 수행합니다. 예를 들어, `dd`, `yy`, `cc` 는 전체 줄에 **삭제**, **복사**, **변경** 작업을 수행합니다. 다른 연산자들도 시도해 보시기 바랍니다!

정말 멋집니다. 여기서 패턴이 보입니다. 하지만, 아직 끝난 게 아닙니다. Vim에는 한 가지 명사 유형가 더 있습니다: 텍스트 객체입니다.


## More Nouns (Text Objects)
괄호 쌍 `(hello Vim)` 안에 있다고 가정합니다. 괄호 안의 문장 전체를 삭제해야 합니다. 어떻게 빠르게 처리할 수 있을까요? 현재 속한 “그룹” 을 삭제하는 방법이 있을까요?

답은 "네" 입니다. 텍스트는 종종 구조화되어 있습니다. 괄호, 따옴표, 대괄호, 중괄호 등을 포함합니다. Vim은 텍스트 객체로 이런 구조를 포착하는 방법을 제공합니다.

텍스트 객체는 연산자와 함께 사용됩니다. 텍스트 객체는 "내부 객체" 와 "외부 객체" 두 가지 유형이 있습니다.

```
i + object    내부 텍스트 객체
a + object    외부 텍스트 객체
```

내부 텍스트 객체는 공백이나 주변 객체를 **제외한** 내부 객체를 선택합니다. 외부 텍스트 객체는 공백이나 주변 객체를 **포함한** 내부 객체를 선택합니다. 일반적으로 외부 텍스트 객체는 내부 텍스트 객체보다 항상 더 많은 텍스트를 선택합니다. 커서가 `(hello Vim)` 표현식 내의 괄호 안에 위치해 있다면:

- 괄호는 삭제하지 않고 괄호 안의 텍스트만 삭제하려면: `di(`
- 괄호와 안의 텍스트를 모두 삭제하려면: `da(`

다른 예를 살펴보겠습니다. 자바스크립트 함수가 있고 커서가 “Hello” 의 “H” 에 있다고 가정합니다:

```javascript
const hello = function() {
  console.log("Hello Vim");
  return true;
}
```

- “Hello Vim” 전체 삭제: `di(`
- 함수 내용(`{}` 로 둘러싸인 부분) 삭제: `di{`
- “Hello” 문자열 삭제: `diw`

텍스트 객체는 한 위치에서 다양한 객체를 대상으로 처리할 수 있으므로 강력합니다. 괄호 안의 객체, 함수 블록, 현재 단어 등을 삭제할 수 있습니다. 기억법으로, `di(`, `di{`, `diw` 를 보면 각각 어떤 텍스트 객체를 나타내는지 쉽게 알 수 있습니다: 괄호 한 쌍, 중괄호 한 쌍, 단어 하나입니다.

마지막 예를 살펴보겠습니다. 다음과 같은 HTML 태그가 있다고 가정합니다:

```html
<div>
  <h1>Header1</h1>
  <p>Paragraph1</p>
  <p>Paragraph2</p>
</div>
```

If your cursor is on "Header1" text:
- To delete "Header1": `dit`.
- To delete `<h1>Header1</h1>`: `dat`.

If your cursor is on "div":
- To delete `h1` and both `p` lines: `dit`.
- To delete everything: `dat`.
- To delete "div": `di<`.

Below is a list of common text objects:

커서가 “Header1” 에 있을 때:

- “Header1” 삭제: `dit`
- `<h1>Header1</h1>` 삭제: `dat`

커서가 “div” 에 있을 때:

- `h1` 과 두 개의 `p` 줄을 삭제하려면: `dit`
- 모든 것을 삭제하려면: `dat`
- “div” 를 삭제하려면: `di<`

다음은 일반적인 텍스트 객체 목록입니다:

```
w         단어 하나
p         단락 하나
s         문장 하나
( 또는 )    괄호 한 쌍
{ 또는 }    중괄호 한 쌍
[ 또는 ]    대괄호 한 쌍
< 또는 >    각괄호 한 쌍
t         XML 태그
"         따옴표 한 쌍
'         작은따옴표 한 쌍
`         백틱 한 쌍
```

자세한 내용은 `:h text-objects`를 참조합니다.


## Composability and Grammar
Vim 문법은 Vim의 조합 가능성의 하위 집합입니다. Vim에서 조합 가능성과 이것이 텍스트 편집기에 훌륭한 기능인 이유에 대해 논의해 보겠습니다.

조합 가능성은 좀 더 복잡한 명령을 수행하기 위해 결합(조합)할 수 있는 일반 명령 집합을 의미합니다. 프로그래밍에서 단순한 추상화로 좀 더 복잡한 추상화를 만들 수 있는 것처럼, Vim도 단순한 명령으로 복잡한 명령을 실행할 수 있습니다. Vim 문법은 Vim의 조합 가능성을 구현한 형태입니다.

Vim의 조합 가능성은 외부 프로그램과 연동할 때 진정한 힘을 발휘합니다. Vim은 텍스트 필터로 외부 프로그램을 사용할 수 있는 필터 연산자(`!`)를 제공합니다. 다음와 같은 복잡한 텍스트를 표 형식으로 변환한다고 가정해 보겠습니다:

```
Id|Name|Cuteness
01|Puppy|Very
02|Kitten|Ok
03|Bunny|Ok
```

Vim 명령으로 쉽게 처리할 수 없지만, 터미널 `column` 명령이 있다면 `column` 터미널 명령으로 빠르게 처리할 수 있습니다. 커서를 “Id” 에 위치시킨 상태에서 `!}column -t -s “|”` 를 실행합니다. 짜잔!! 이제 단 한 번의 명령으로 다음과 같은 깔끔한 표 형식의 데이터를 얻을 수 있습니다.

```
Id  Name    Cuteness
01  Puppy   Very
02  Kitten  Ok
03  Bunny   Ok
```

명령어를 분석해 보겠습니다. 동사는 `!` (필터 연산자)였고 명사는 `}` (다음 단락으로 이동)였습니다. 필터 연산자 `!` 는 또 다른 인자(터미널 명령어)를 받아들이므로 `column -t -s “|”` 를 전달했습니다. `column` 의 작동 방식은 생략하지만, 결과적으로 텍스트를 표 형식으로 변환했습니다.

텍스트를 표 형식으로 변환할 뿐만 아니라 “Ok” 가 포함된 행만 표시한다고 가정합니다. `awk` 가 이 작업을 쉽게 수행할 수 있다는 것을 알고 있습니다. 다음과 같이 처리할 수 있습니다:

```
!}column -t -s "|" | awk 'NR > 1 && /Ok/ {print $0}'
```

실행 결과:

```
02  Kitten  Ok
03  Bunny   Ok
```

좋습니다! 외부 명령 연산자도 파이프(`|`)를 사용할 수 있습니다.

이것이 바로 Vim의 조합 가능성의 강력한 힘입니다. 연산자, 이동 명령, 터미널 명령을 많이 알수록 복잡한 동작을 조합하는 능력이 **배가** 됩니다.

4가지 이동 명령(`w, $, }, G`)과 하나의 연산자(`d`)만 알고 있다고 가정합니다. 이렇게 하면 8가지 작업을 수행할 수 있습니다: 4가지 방향으로 **이동**(`w, $, }, G`)하고 4가지 다른 대상(`dw, d$, d}, dG`)을 **삭제** 할 수 있습니다. 그러던 어느 날 대문자 연산자(`gU`)를 배우게 됩니다. Vim 도구 상자에 새로운 능력을 하나가 아닌 **4가지** 추가한 셈입니다: `gUw, gU$, gU}, gUG`. 이로써 Vim 도구 상자의 도구는 정체 12개가 됩니다. 새로운 지식 하나하나가 현재 능력에 곱셈 효과를 줍니다. 10개의 이동 명령과 5개의 연산자를 안다면, 무기고에 60가지 동작(50가지 연산 + 10가지 이동)이 있는 셈입니다. Vim에는 줄 번호 이동 명령(`nG`)이 있어 `n` 번의 이동을 제공합니다. 여기서 `n` 은 파일의 줄 수입니다. (5번째 줄로 이동하려면 `5G` 실행) 검색 이동 명령(`/`)은 사실상 무제한의 이동을 가능하게 합니다. 무엇이든 검색할 수 있기 때문입니다. 외부 명령 연산자(`!`)는 터미널 명령어를 아는 만큼의 필터링 도구를 제공합니다. Vim처럼 조합 가능한 도구를 사용하면, 알고 있는 모든 것을 연결해서 점점 복잡해지는 작업을 수행할 수 있습니다. 아는 것이 많을수록 더욱 강력해집니다.

이런 조합 가능한 동작은 유닉스 철학인 “한 가지를 잘하라” 를 반영합니다. 연산자는 하나의 임무만 수행합니다: Y를 실행하라. 이동 명령은 하나의 임무만 수행합니다: X로 이동하라. 연산자와 이동 명령을 결합하면 예측 가능하게 YX 를 얻습니다: X에 대해 Y를 실행하라.

이동 명령과 연산자는 확장 가능합니다. 사용자 정의 이동 명령과 연산자를 만들어 Vim 도구 모음에 추가할 수 있습니다. [`vim-textobj-user`](https://github.com/kana/vim-textobj-user) 플러그인을 사용하면 사용자 정의 텍스트 객체를 만들 수 있습니다. 또한, 사용자 제작 커스텀 텍스트 객체 [목록](https://github.com/kana/vim-textobj-user/wiki)도 포함되어 있습니다.


## Learn Vim Grammar the Smart Way
방금 Vim 문법의 규칙인 `동사 + 명사` 에 대해 배웠습니다. 저에게 가장 큰 Vim ‘아하!’ 순간 중 하나는 대문자 변환 연산자(`gU`)를 막 배운 후 현재 단어를 대문자로 바꾸고 싶었을 때, **본능적으로** `gUiw` 를 실행했는데 작동했던 순간이었습니다!! 단어가 대문자로 바뀌었습니다. 그 순간 비로소 Vim을 제대로 이해하기 시작했습니다. 여러분도 아직 경험하지 않았다면, 곧 자신만의 “아하!” 순간을 맞이하시길 바랍니다.

이 장의 목표는 Vim의 `동사 + 명사` 패턴을 보여줌으로써, 모든 명령어 조합을 암기하는 방식이 아니라 여러분이 Vim을 새로운 언어를 배우듯이 접근하도록 만드는 것입니다.

패턴을 익히고 그 함의를 이해해야 합니다. 그것이 가장 현명한 학습법입니다.


## Link
- Prev [Ch03. Searching Files](./ch03_searching_files.md)
- Next [Ch05. Moving in a File](./ch05_moving_in_file.md)
