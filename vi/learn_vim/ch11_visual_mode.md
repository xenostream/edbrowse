# Ch11. Visual Mode
텍스트 블록에 변경 사항을 강조 표시하고 적용하는 것은 많은 텍스트 편집기와 워드 프로세서에서 흔히 볼 수 있는 기능입니다. Vim은 시각 모드를 사용해서 이를 수행할 수 있습니다. 이 장은 시각 모드를 활용해서 텍스트를 효율적으로 조작하는 방법을 배웁니다.


## The Three Types of Visual Modes
Vim에는 세 가지 다른 시각 모드가 있습니다. 이들은 다음과 같습니다:

```
v         문자 단위 시각 모드
V         줄 단위 시각 모드
Ctrl-V    블록 단위 시각 모드
```

다음과 같은 텍스트를 가정합니다:

```
one
two
three
```

문자 단위 시각 모드는 개별 문자를 대상으로 작동합니다. 첫 번째 문자에서 `v` 를 누릅니다. 그런 다음 `j` 로 다음 줄로 이동합니다. 그러면 “one” 부터 커서 위치까지 모든 텍스트가 강조 표시됩니다. `gU` 를 누르면 Vim은 강조 표시된 문자를 대문자로 변환합니다.

줄 단위 시각 모드는 줄 단위로 작동합니다. `V` 를 누르면 커서가 위치한 줄 전체가 선택됩니다. 문자 단위 시각 모드와 마찬가지로 `gU` 를 실행하면 Vim은 강조 표시된 문자를 대문자로 변환합니다.

블록 단위 시각 모드는 행과 열을 대상으로 처리합니다. 다른 두 모드보다 좀 더 자유로운 이동이 가능합니다. `Ctrl-V` 를 누르면 문자 단위 시각 모드처럼 커서 문자를 강조 표시하지만, 줄 끝까지 각 문자를 강조한 후 다음 줄로 이동하는 대신 최소한의 강조만 한 채로 다음 줄로 이동합니다. `h/j/k/l` 로 이동하면서 커서 움직임을 확인합니다.

Vim 창 좌측 하단에는 현재 사용 중인 비주얼 모드를 표시하기 위해 `-- VISUAL --`, `-- VISUAL LINE --` 또는 `-- VISUAL BLOCK --` 중 하나가 표시됩니다.

비주얼 모드 내에서 `v`, `V` 또는 `Ctrl-V` 를 눌러 다른 비주얼 모드로 전환할 수 있습니다. 예를 들어, 줄 단위 비주얼 모드에서 블록 단위 비주얼 모드로 전환하려면 `Ctrl-V` 를 실행합니다. 직접 시도해 보시기 바랍니다!

비주얼 모드를 종료하는 방법은 세 가지입니다: `<Esc>`, `Ctrl-C`, 그리고 현재 비주얼 모드와 동일한 키입니다. 후자의 의미는 현재 줄 단위 비주얼 모드(`V`)에 있다면 `V` 를 다시 눌러 종료할 수 있다는 뜻입니다. 문자 단위 비주얼 모드에 있다면 `v` 를 눌러 종료할 수 있습니다.

사실 비주얼 모드로 진입하는 방법이 하나 더 있습니다:

```
gv    이전 시각 모드로 이동
```

지난 번과 동일한 시각 모드를 동일한 강조 표시된 텍스트 블록에서 시작합니다.


## Visual Mode Navigation
비주얼 모드는 Vim 이동 명령으로 강조 표시된 텍스트 블록을 확장할 수 있습니다.

앞서 사용한 동일한 텍스트를 사용합니다:

```
one
two
three
```

이번에는 “two” 줄부터 시작합니다. `v` 를 눌러 문자 단위 비주얼 모드로 진입합니다. (여기서 대괄호 `[]` 는 문자 강조 표시를 나타냅니다.):

```
one
[t]wo
three
```

`j` 를 누르면 Vim은 “two” 줄부터 “three” 줄의 첫 글자까지 모든 텍스트를 강조 표시합니다.

```
one
[two
t]hree
```

이 위치에서 “one” 줄도 추가한다고 가정해 보겠습니다. `k` 를 누르면, 안타깝게도 강조 표시는 “three” 줄에서 벗어납니다. 

```
one
[t]wo
three
```

시각적 선택 영역을 원하는 방향으로 자유롭게 확장할 수 있는 방법이 있을까요? 물론입니다. “two” 와 “three” 줄이 강조 표시된 상태로 조금 뒤로 돌아가 보겠습니다.

```
one
[two
t]hree    <-- 커서 위치
```

시각적 선택 영역은 커서 이동을 따라갑니다. “one” 줄까지 위로 확장하려면 커서를 ‘two’ 줄로 올려야 합니다. 현재 커서는 “three” 줄에 있습니다. 커서 위치를 `o` 또는 `O` 로 전환할 수 있습니다.

```
one
[two     <-- 커서 위치
t]hree
```

이제 `k` 를 누르면 선택 영역이 축소되지 않고 위쪽으로 확장됩니다.

```
[one
two
t]hree
```

비주얼 모드에서 `o` 또는 `O` 를 사용하면 커서가 강조 표시된 블록의 시작부터 끝까지 이동해서 강조 영역을 확장할 수 있습니다.


## Visual Mode Grammar
비주얼 모드는 일반 모드와 많은 조작 방식을 공유합니다.

예를 들어, 다음과 같은 텍스트가 있고 비주얼 모드에서 처음 두 줄을 삭제하려면:

```
one
two
three
```

줄 단위 비주얼 모드(`V`)로 “one” 과 “two” 줄을 강조 표시합니다:

```
[one
two]
three
```

`d` 를 누르면 선택 영역은 삭제됩니다. 일반 모드와 유사합니다. "일반 모드의 문법 규칙(동사 + 명사)이 적용되지 않는다" 는 점에 유의합니다. 동일한 동사(`d`)는 그대로지만, 시각 모드는 명사가 없습니다! 시각 모드의 문법 규칙은 "명사 + 동사" 이며, 여기서 명사는 강조 표시된 텍스트입니다. 먼저 텍스트 블록을 선택한 다음 명령어를 입력합니다.

일반 모드는 커서의 단일 문자를 삭제하는 `x` 나 커서의 문자를 대체하는 `r` (`rx` 는 커서의 문자를 “x” 로 대체)처럼 이동 명령이 필요 없는 명령들이 있습니다. 시각 모드는 이런 명령들이 이제 단일 문자가 아닌 전체 선택된 텍스트에 적용됩니다. 다시 선택된 텍스트로 돌아가서:

```
[one
two]
three
```

`x` 를 실행하면 선택된 모든 텍스트가 삭제됩니다.

이 동작을 활용하면 마크다운 텍스트에서 헤더를 빠르게 생성할 수 있습니다. 예를 들어, 다음 텍스트를 1단계 마크다운 헤더(`“===”`)로 빠르게 변환한다고 가정해 보겠습니다:

```
Chapter One
```

먼저 `yy` 로 텍스트를 복사한 다음 `p` 로 붙여넣습니다:

```
Chapter One
Chapter One
```

이제 두 번째 줄로 이동해서 줄 단위 시각 모드로 선택합니다:

```
Chapter One
[Chapter One]
```

1단계 헤더는 텍스트 아래 “=” 가 연속으로 표시됩니다. `r=` 을 실행하면, 짜잔! 이렇게 하면 “=” 를 수동으로 입력할 필요가 없습니다.

```
Chapter One
===========
```

시각 모드의 연산자에 대해 자세히 알아보려면 `:h visual-operators` 를 확인합니다.


## Visual Mode and Command-line Commands
선택적으로 강조 표시된 텍스트 블록에 명령줄 명령을 적용할 수 있습니다. 다음과 같은 문장이 있고, 첫 두 줄만 “const” 를 “let” 으로 대체하려면:

```
const one = “one”;
const two = “two”;
const three = “three”;
```

**어떤** 시각 모드든 처음 두 줄을 선택한 후 대체 명령어 `:s/const/let/g` 를 실행합니다:

```
let one = “one”;
let two = “two”;
const three = “three”;
```

**어떤** 시각 모드도 가능하다고 말씀드렸습니다. 해당 줄 전체를 강조 표시하지 않아도 됩니다. 각 줄에서 최소한 한 글자 이상만 선택하면 명령이 적용됩니다.


## Adding Text on Multiple Lines
Vim에서 블록 단위 시각 모드를 사용해서 여러 줄에 텍스트를 추가할 수 있습니다. 각 줄 끝에 세미콜론을 추가할 경우:

```
const one = “one”
const two = “two”
const three = “three”
```

커서를 첫 번째 줄에 위치시킨 상태에서:

- 블록 단위 시각 모드를 실행하고 두 줄 아래로 이동합니다. (`Ctrl-V jj`)
- 줄 끝까지 선택합니다. (`$`)
- 추가(`A`) 모드로 “;” 를 입력합니다.
- 시각 모드를 종료합니다. (`<Esc>`)

이제 각 줄 끝에 “;” 가 추가된 것을 확인할 수 있습니다. 꽤 멋집니다! 

블록 단위 시각 모드에서 삽입 모드로 진입하는 두 가지 방법이 있습니다: 커서 뒤에 텍스트를 입력하려면 `A` 를, 커서 앞에 텍스트를 입력하려면 `I` 를 사용합니다. 일반 모드에서 사용하는 `A` (줄 끝에 텍스트 추가)와 `I` (첫 번째 비어 있지 않은 줄 앞에 텍스트 삽입)와 혼동하지 마시기 바랍니다.

대안으로 `:normal` 명령어를 사용해서 여러 줄에 텍스트를 추가할 수도 있습니다:

- 3줄 전체를 선택합니다. (`vjj`)
- `:normal! A;` 를 입력합니다.

`:normal` 명령어는 일반 모드 명령어를 실행합니다. 이 명령어로 `A;` 를 실행하면 줄 끝에 “;” 텍스트를 추가할 수 있습니다.


## Incrementing Numbers
Vim에는 숫자를 감소 및 증가시키는 `Ctrl-X` 및 `Ctrl-A` 명령이 있습니다. 시각 모드에서 사용하면 여러 줄에 숫자를 증가시킬 수 있습니다.

다음과 같은 HTML 요소가 있다면:

```
<div id="app-1"></div>
<div id="app-1"></div>
<div id="app-1"></div>
<div id="app-1"></div>
<div id="app-1"></div>
```

동일한 이름을 가진 여러 ID를 사용하는 것은 좋지 않은 관행이므로 고유하게 만들기 위해 번호를 증가시키겠습니다:

- 커서를 두 번째 줄의 “1” 로 이동합니다.
- 블록 단위 시각 모드를 시작하고 3줄 아래로 이동합니다. (`Ctrl-V 3j`) 이렇게 하면 나머지 “1” 들이 강조 표시됩니다. 이제 첫 번째 줄을 제외한 모든 “1” 이 강조 표시되야 합니다.
- `g Ctrl-A` 를 실행합니다.

다음과 같은 결과가 표시되야 합니다:

```
<div id="app-1"></div>
<div id="app-2"></div>
<div id="app-3"></div>
<div id="app-4"></div>
<div id="app-5"></div>
```

`g Ctrl-A` 는 여러 줄의 숫자를 증가시킵니다. `Ctrl-X/Ctrl-A` 는 숫자 형식 옵션과 함께 문자도 증가시킬 수 있습니다:

```
set nrformats+=alpha
```

`nrformats` 옵션은 Vim이 `Ctrl-A` 및 `Ctrl-X` 로 증가/감소시킬 때 어떤 기호를 “숫자” 로 간주할지 지정합니다. `alpha` 를 추가하면 알파벳 문자도 숫자로 간주됩니다. 다음과 같은 HTML 요소가 있다면:

```
<div id="app-a"></div>
<div id="app-a"></div>
<div id="app-a"></div>
<div id="app-a"></div>
<div id="app-a"></div>
```

두 번째 “app-a” 에 커서를 위치합니다. 위와 동일한 기법(`Ctrl-V 3j` 다음 `g Ctrl-A`)을 사용해서 ID를 증가시킵니다.

```
<div id="app-a"></div>
<div id="app-b"></div>
<div id="app-c"></div>
<div id="app-d"></div>
<div id="app-e"></div>
```


## Selecting the Last Visual Mode Area
이 장 초반에 `gv` 가 마지막 비주얼 모드 하이라이트를 빠르게 강조 표시할 수 있다고 언급했습니다. 또한, 다음 두 특수 마크를 사용해서 마지막 비주얼 모드의 시작점과 끝점 위치로 이동할 수 있습니다:

```
`<    이전 시각 모드 하이라이트의 첫 번째 위치로 이동
`>    이전 시각 모드 하이라이트의 마지막 위치로 이동
```

앞서 언급했듯이, 강조 표시된 텍스트에 선택적으로 명령줄 명령을 실행할 수 있습니다. 예를 들어, `:s/const/let/g` 같이 말입니다. 그렇게 하면 다음과 같은 결과가 나타납니다:

```
:`<,`>s/const/let/g
```

실제로는 **범위 지정된** `s/const/let/g` 명령어(두 마크가 주소 역할을 함)를 실행합니다. 꽤 흥미롭습니다!

이 마크들은 언제든지 편집할 수 있습니다. 만약 강조 표시된 텍스트의 시작부터 파일 끝까지 대체한다면, 명령어를 다음과 같이 변경합니다:

```
:`<,$s/const/let/g
```


## Entering Visual Mode From Insert Mode
삽입 모드에서 시각 모드로 진입할 수도 있습니다. 삽입 모드에서 문자 단위 시각 모드로 전환하려면:

```
Ctrl-O v
```

삽입 모드에서 `Ctrl-O` 를 실행하면 일반 모드 명령을 실행할 수 있습니다. 이 일반 모드 명령 대기 상태에서 `v` 를 실행하면 문자 단위 시각 모드로 진입합니다. 화면 좌하단에 `--(insert) VISUAL--` 이라 표시되는 것을 확인할 수 있습니다. 이 방법은 모든 시각 모드 연산자(`v`, `V`, `Ctrl-V`)에서 동일하게 작동합니다.


## Select Mode
Vim에는 시각 모드와 유사한 선택 모드라는 모드가 있습니다. 시각 모드와 마찬가지로, 이 모드 역시 세 가지 다른 모드를 가지고 있습니다:

```
gh         문자 단위 선택 모드
gH         줄 단위 선택 모드
gCtrl-h    블록 단위 선택 모드
```

선택 모드는 Vim의 시각 모드보다 일반 편집기의 텍스트 강조 표시 동작을 좀 더 가깝게 모방합니다.

일반 편집기는 텍스트 블록을 강조 표시한 후 문자(예: ‘y’)를 입력하면 강조된 텍스트는 삭제되고 해당 문자가 삽입됩니다. 행 단위 선택 모드(`gH`)로 한 줄을 강조 표시한 후 'y' 를 입력하면 강조된 텍스트는 삭제되고 'y' 가 삽입됩니다.

이런 선택 모드를 시각 모드와 비교합니다: 줄 단위 시각 모드(`V`)로 텍스트 줄을 강조 표시한 후 “y” 를 입력하면, 강조 표시된 텍스트는 삭제되고 문자 그대로의 “y” 로 대체되지 않습니다. 대신 복사됩니다. 선택 모드에서 강조 표시된 텍스트에 일반 모드 명령을 실행할 수 없습니다.

저는 개인적으로 선택 모드를 사용한 적이 없지만, 그 존재를 안다는 것은 좋습니다.


## Learn Visual Mode the Smart Way
비주얼 모드는 Vim에서 텍스트 강조 표시 절차를 구현한 방식입니다.

일반 모드 작업보다 비주얼 모드 작업을 훨씬 더 자주 사용한다면 주의해야 합니다. 이는 안티패턴입니다. 비주얼 모드 작업은 동일한 작업을 일반 모드로 수행할 때보다 더 많은 키 입력이 필요합니다. 예를 들어, 내부 단어를 삭제할 때, 왜 네 번의 키 입력(`viwd`: 내부 단어 시각적 강조 후 삭제)을 사용합니까? 세 번의 키 입력(`diw`)만으로 달성할 수 있습니다. 후자가 좀 더 직접적이고 간결합니다. 물론 시각 모드가 적절한 경우도 있겠지만, 일반적으로 좀 더 직접적인 접근 방식을 선호하시기 바랍니다.



## Link
- Prev [Ch10. Undo](./ch10_undo.md)
- Next [Ch12. Search and Substitute](./ch12_search_and_substitute.md)
